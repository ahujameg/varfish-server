{% extends 'projectroles/project_base.html' %}
{% load projectroles_common_tags %}
{% load rules %}
{% load crispy_forms_tags %}
{% load static %}

{% block navi_sub_project_extend %}
  <li class="breadcrumb-item"><a href="{% url "variants:case-list" project=project.sodar_uuid %}">Cases</a></li>
  <li class="breadcrumb-item active">Joint Filtration</li>
{% endblock %}

{% block projectroles %}

{% block css %}
  {{ block.super }}
  <style type="text/css">
    .display-exac .detail-gnomad-exomes,
    .display-exac .detail-gnomad-genomes,
    .display-exac .detail-thousand-genomes,
    .display-gnomad-exomes .detail-exac,
    .display-gnomad-exomes .detail-gnomad-genomes,
    .display-gnomad-exomes .detail-thousand-genomes,
    .display-gnomad-genomes .detail-exac,
    .display-gnomad-genomes .detail-gnomad-exomes,
    .display-gnomad-genomes .detail-thousand-genomes,
    .display-thousand-genomes .detail-exac,
    .display-thousand-genomes .detail-gnomad-exomes,
    .display-thousand-genomes .detail-gnomad-genomes {
      display: none;
    }

    .varfish-variant-table th {
      text-align: center;
    }

    .variant-row-positive { background-color: #28a74533; }
    .variant-row-uncertain { background-color: #ffc10733; }
    .variant-row-negative { background-color: #dc354533; }

    .compact-form-groups .form-group {
      margin-bottom: 0;
    }
  </style>
{% endblock %}

  <div class="row sodar-pr-content-title pb-2">
    <h2 class="sodar-pr-content-title">
      Joint Filtration in Project &quot;{{ project.title }}&quot;
    </h2>
  </div>

  <div class="container-fluid sodar-page-container">
    {% include "variants/_filter_form.html" %}
  </div>

  {% if result_rows is None %}
  {% elif not result_rows %}
    <div class="container-fluid sodar-page-container">
      <h2>
        Empty Result Set
        <small class="text-muted">
          Try again with different settings?
        </small>
      </h2>
    </div>
  {% else %}
    <div class="sodar-subtitle-container bg-white sticky-top pr-0 mr-0 pb-0">
      <div class="form-inline pl-2 pr-2 row">
        <div class="p-2">
          <strong style="font-size: 140%;">
            Results
          </strong>
        </div>
        <div class="p-2 form-group">
          <label class="mr-2" for="result-display-frequencies">
            Frequencies
          </label>
          <select class="custom-select" id="result-display-frequencies" onchange="javascript: updateTableDisplay();">
            <option value="exac" selected>ExAC</option>
            <option value="thousand-genomes">1000 genomes</option>
            <option value="gnomad-exomes">gnomAD exomes</option>
            <option value="gnomad-genomes">gnomAD genomes</option>
          </select>
        </div>
        <div class="pl-3">
          First <strong>{{ result_rows|length }} of {{ result_count }}</strong> records
          <i class="fa fa-info-circle" data-toggle="tooltip"
             title="Use the &quot;Result row limit&quot; to see more columns. Pro-tip: TSV/Excel/VCF file downloads will contain all all {{ result_count }} rows."></i>.
        </div>
        <div class="pl-3">
          Using
          {% if form.cleaned_data.database_select == "refseq" %}
            <strong>RefSeq</strong>
          {% else %}
            <strong>ENSEMBL</strong>
          {% endif %}
          transcripts.
        </div>
      </div>
    </div>

   <div class="container-fluid sodar-page-container">
     <div id="table-config">
      <table class="table table-hover table-sm varfish-variant-table" id="main">
        <thead>
          {% include "variants/filter_result/header.html" %}
        </thead>
        <tbody>
        {% for entry in result_rows %}
          {% include "variants/filter_result/row.html" %}
          {% include "variants/filter_result/card.html" %}
        {% endfor %}
        </tbody>
      </table>
    </div>

    <p>
      Query completed in {{ elapsed_seconds }} sec.
    </p>
  </div> <!-- sodar-page-container -->
  {% endif %}
{% endblock projectroles %}

{% comment %}
{% block javascript %}
  {{ block.super }}
  {% include "variants/script_filter_form.html" %}
{% endblock javascript %}
{% endcomment %}
