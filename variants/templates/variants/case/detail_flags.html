{% load humanize %}
{% load variants_tags %}
{% load projectroles_common_tags %}
{% get_django_setting 'VARFISH_ENABLE_SVS' as svs_enabled %}

<div class="card varfish-vars-case-details"
     id="card-varfish-vars-case-details-small-var-flags">
  <div class="card-header">
    <h4>
      <i class="fa fa-flag"></i>
      Flagged Small Variants
    </h4>
  </div>
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th style="width: 200px;" rowspan="2" class="align-text-top"><div class="sodar-overflow-container sodar-overflow-hover">Variant</div></th>
        <th style="width: 80px;" rowspan="2" class="align-text-top"><div class="sodar-overflow-container sodar-overflow-hover">Gene(s)</div></th>
        <th colspan="4" class="text-center border-bottom-0">Flags</th>
      </tr>
      <tr>
        <th class="text-center">Generic</th>
        <th class="text-center">Visual</th>
        <th class="text-center">Validation</th>
        <th class="text-center">Phenotype</th>
      </tr>
    </thead>
    <tbody>
      {% for flagged_variant in case.small_variant_flags.all %}
        <tr id="flags-{{ flagged_variant.get_variant_description }}">
          <td class="text-nowrap">
            chr{{ flagged_variant.chromosome }}:{{ flagged_variant.start|intcomma }}-{{ flagged_variant.reference }}-{{ flagged_variant.alternative }}
          </td>
          <td>
            {{ flagged_variant.get_gene_symbols|join:", "|default:"-" }}
          </td>
          <td class="text-center">
            <i class="fa fa-fw fa-star {% if not flagged_variant.flag_bookmarked %}text-muted{% endif %}"></i>
            <i class="fa fa-fw fa-flask {% if not flagged_variant.flag_for_validation %}text-muted{% endif %}"></i>
            <i class="fa fa-fw fa-heart {% if not flagged_variant.flag_candidate %}text-muted{% endif %}"></i>
            <i class="fa fa-fw fa-flag-checkered {% if not flagged_variant.flag_final_causative %}text-muted{% endif %}"></i>
          </td>
          <td class="text-center">
            <i class="fa fa-fw {{ flagged_variant.flag_visual|flag_value_to_fa }}"></i>
          </td>
          <td class="text-center">
            <i class="fa fa-fw {{ flagged_variant.flag_validation|flag_value_to_fa }}"></i>
          </td>
          <td class="text-center">
            <i class="fa fa-fw {{ flagged_variant.flag_phenotype_match|flag_value_to_fa }}"></i>
          </td>
        </tr>
      {% endfor %}
      {% if not case.small_variant_flags.all %}
        <tr>
           <td class="bg-faded font-italic text-center" colspan="6">
             No flags yet.
           </td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% if svs_enabled %}
  <div class="card varfish-vars-case-details"
       id="card-varfish-vars-case-details-structural-var-flags">
    <div class="card-header">
      <h4>
        <i class="fa fa-flag"></i>
        Flagged Structural Variants
      </h4>
    </div>
    <table class="table tabled-striped table-hover">
      <thead>
        <tr>
          <th style="width: 200px;" rowspan="2" class="align-text-top"><div class="sodar-overflow-container sodar-overflow-hover">Variant</div></th>
          <th style="width: 80px;" rowspan="2" class="align-text-top"><div class="sodar-overflow-container sodar-overflow-hover">Type</div></th>
          <th colspan="4" class="text-center border-bottom-0">Flags</th>
        </tr>
        <tr>
          <th class="text-center">Generic</th>
          <th class="text-center">Visual</th>
          <th class="text-center">Validation</th>
          <th class="text-center">Phenotype</th>
        </tr>
      </thead>
      <tbody>
        {% for flagged_variant in case.structural_variant_flags.all %}
          <tr id="flags-{{ flagged_variant.get_variant_description }}">
            <td class="text-nowrap">
              {{ flagged_variant.get_variant_description }}
            </td>
            <td class="text-nowrap">
              {{ sv_comment.sv_type }}
            </td>
            <td class="text-center">
              <i class="fa fa-fw fa-star {% if not flagged_variant.flag_bookmarked %}text-muted{% endif %}"></i>
              <i class="fa fa-fw fa-flask {% if not flagged_variant.flag_for_validation %}text-muted{% endif %}"></i>
              <i class="fa fa-fw fa-heart {% if not flagged_variant.flag_candidate %}text-muted{% endif %}"></i>
              <i class="fa fa-fw fa-flag-checkered {% if not flagged_variant.flag_final_causative %}text-muted{% endif %}"></i>
            </td>
            <td class="text-center">
              <i class="fa fa-fw {{ flagged_variant.flag_visual|flag_value_to_fa }}"></i>
            </td>
            <td class="text-center">
              <i class="fa fa-fw {{ flagged_variant.flag_validation|flag_value_to_fa }}"></i>
            </td>
            <td class="text-center">
              <i class="fa fa-fw {{ flagged_variant.flag_phenotype_match|flag_value_to_fa }}"></i>
            </td>
          </tr>
        {% endfor %}
        {% if not case.small_variant_flags.all %}
          <tr>
             <td class="bg-faded font-italic text-center" colspan="6">
               No flags yet.
             </td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
{% endif %}
